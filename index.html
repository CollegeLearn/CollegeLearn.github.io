<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3F1QKGNWSE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-3F1QKGNWSE');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Learn</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fef9e6; /* Light yellow background */
        }
    </style>
</head>
<body class="bg-yellow-50 p-8">
    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-lg p-8">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">College Learn</h1>
            <p class="text-gray-600">
                Search and filter university and degree information.
            </p>
        </header>

        <!-- Search and Limit Section -->
        <div class="flex flex-col md:flex-row items-center justify-between mb-4 space-y-4 md:space-y-0 md:space-x-4">
            <input type="text" id="searchInput" placeholder="Search by location, university or degree..."
                   class="w-full md:w-3/4 p-3 text-sm text-gray-700 placeholder-gray-400 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition duration-200">
            
            <div class="flex items-center w-full md:w-1/4 space-x-2">
                <span class="text-sm text-gray-600">Show:</span>
                <select id="limitFilter" class="w-full p-3 text-sm text-gray-700 bg-green-100 border border-green-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-700 focus:border-transparent transition duration-200">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
        </div>

        <!-- Filter Dropdown Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <select id="cityFilter" class="w-full p-3 text-sm text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition duration-200">
                <option value="">All Cities</option>
            </select>
            <select id="countryFilter" class="w-full p-3 text-sm text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition duration-200">
                <option value="">All Countries</option>
            </select>
            <select id="degreeLevelFilter" class="w-full p-3 text-sm text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition duration-200">
                <option value="">All Degree Levels</option>
            </select>
            <select id="degreeFilter" class="w-full p-3 text-sm text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition duration-200">
                <option value="">All Degrees</option>
            </select>
        </div>

        <!-- Data Container -->
        <div id="dataContainer" class="space-y-4">
            <!-- Data will be populated here by JavaScript -->
        </div>

        <!-- Pagination Navigation -->
        <div id="paginationNav" class="flex justify-center items-center space-x-4 mt-6">
            <!-- Pagination buttons will be populated here -->
        </div>

        <!-- Disclaimer -->
        <div class="mt-8 pt-4 border-t border-gray-200 text-center text-xs text-gray-500">
            <span class="font-bold">Disclaimer:</span> This information is for general guidance only. All data is compiled from publicly available sources and is not an endorsement or official representation of any specific institution.
        </div>
</div>

    <!-- JavaScript for CSV Parsing and Filtering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        // Sample CSV data string for demonstration.
        // It now includes UniversityLink and DegreeLink fields.

        const csvFilePath = "https://github.com/CollegeLearn/CollegeLearn.github.io/blob/main/university_data.csv";
        const csvData = await fetch(csvFilePath);
        const csvDataString = await csvData.text();

        let data = [];
        let filteredData = [];
        let currentPage = 1;
        let totalPages = 1;

        // Fetch, parse, and initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            Papa.parse(csvDataString, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: (results) => {
                    data = results.data;
                    populateFilters();
                    applyFilters();
                },
                error: (err) => {
                    console.error("Error parsing CSV:", err);
                    document.getElementById('dataContainer').innerHTML = `<div class="bg-gray-50 p-4 text-center text-red-500 rounded-lg">Error loading data.</div>`;
                }
            });
        });

        function populateFilters() {
            const cityFilter = document.getElementById('cityFilter');
            const countryFilter = document.getElementById('countryFilter');
            const degreeLevelFilter = document.getElementById('degreeLevelFilter');
            const degreeFilter = document.getElementById('degreeFilter');

            const cities = [...new Set(data.map(item => item.City).filter(Boolean))].sort();
            const countries = [...new Set(data.map(item => item.Country).filter(Boolean))].sort();
            const degreeLevels = [...new Set(data.map(item => item.DegreeLevel).filter(Boolean))].sort();
            const degrees = [...new Set(data.map(item => item.Degree).filter(Boolean))].sort();

            cities.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                cityFilter.appendChild(option);
            });

            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countryFilter.appendChild(option);
            });

            degreeLevels.forEach(level => {
                const option = document.createElement('option');
                option.value = level;
                option.textContent = level;
                degreeLevelFilter.appendChild(option);
            });
            
            degrees.forEach(degree => {
                const option = document.createElement('option');
                option.value = degree;
                option.textContent = degree;
                degreeFilter.appendChild(option);
            });
        }

        function applyFilters() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const cityFilterValue = document.getElementById('cityFilter').value;
            const countryFilterValue = document.getElementById('countryFilter').value;
            const degreeLevelFilterValue = document.getElementById('degreeLevelFilter').value;
            const degreeFilterValue = document.getElementById('degreeFilter').value;
            const limit = parseInt(document.getElementById('limitFilter').value, 10);

            let tempFilteredData = data.filter(item => {
                const searchMatch = Object.values(item).some(value =>
                    value && String(value).toLowerCase().includes(searchInput)
                );

                const cityMatch = cityFilterValue === "" || item.City === cityFilterValue;
                const countryMatch = countryFilterValue === "" || item.Country === countryFilterValue;
                const degreeLevelMatch = degreeLevelFilterValue === "" || item.DegreeLevel === degreeLevelFilterValue;
                const degreeMatch = degreeFilterValue === "" || item.Degree === degreeFilterValue;

                return searchMatch && cityMatch && countryMatch && degreeLevelMatch && degreeMatch;
            });
            
            // Calculate total pages based on all filtered data
            totalPages = Math.ceil(tempFilteredData.length / limit);

            // Get the slice of data for the current page
            const startIndex = (currentPage - 1) * limit;
            const endIndex = startIndex + limit;
            filteredData = tempFilteredData.slice(startIndex, endIndex);

            renderTable();
        }
        
        // This function groups the flat data by university for the hierarchical view
        function groupDataByUniversity(data) {
            const groupedData = {};
            data.forEach(item => {
                const { University, City, Country, DegreeLevel, Degree, Tags, UniversityLink, DegreeLink } = item;
                if (!groupedData[University]) {
                    groupedData[University] = {
                        City: City,
                        Country: Country,
                        UniversityLink: UniversityLink,
                        Degrees: []
                    };
                }
                groupedData[University].Degrees.push({
                    DegreeLevel: DegreeLevel,
                    Degree: Degree,
                    Tags: Tags ? Tags.split(',') : [], // Split tags by comma
                    DegreeLink: DegreeLink
                });
            });
            return groupedData;
        }

        function renderTable() {
            const dataContainer = document.getElementById('dataContainer');
            dataContainer.innerHTML = ''; // Clear previous data
            
            const groupedData = groupDataByUniversity(filteredData);
            const universities = Object.keys(groupedData).sort();

            if (universities.length === 0) {
                dataContainer.innerHTML = `<div class="bg-gray-50 p-4 text-center text-gray-400 rounded-lg">No results found.</div>`;
                renderPagination(); // Still render pagination to show total results
                return;
            }

            universities.forEach(university => {
                const uniData = groupedData[university];

                const universityCard = document.createElement('div');
                universityCard.classList.add('bg-white', 'border', 'border-green-400', 'rounded-lg', 'shadow-md', 'overflow-hidden', 'mb-4');

                // University Header with a link
                const universityHeader = document.createElement('a');
                universityHeader.href = uniData.UniversityLink;
                universityHeader.target = '_blank';
                universityHeader.classList.add('block', 'bg-green-100', 'text-green-900', 'px-6', 'py-4', 'font-semibold', 'text-lg', 'border-b', 'border-green-400', 'hover:bg-green-200', 'transition-colors', 'duration-200');
                
                // New layout for University Name and City/Country
                universityHeader.innerHTML = `
                    <div class="font-bold text-xl">${university}</div>
                    <div class="text-sm font-normal opacity-80">${uniData.City}, ${uniData.Country}</div>
                `;

                universityCard.appendChild(universityHeader);

                // Degrees Table inside the university card
                const degreesTable = document.createElement('table');
                degreesTable.classList.add('min-w-full', 'table-fixed', 'divide-y', 'divide-gray-200');
                degreesTable.innerHTML = `
                    <thead class="bg-green-50">
                        <tr>
                            <th class="py-3 px-6 text-left text-xs font-medium text-green-500 uppercase tracking-wider w-[15%]">Degree Level</th>
                            <th class="py-3 px-6 text-left text-xs font-medium text-green-500 uppercase tracking-wider w-[20%]">Degree</th>
                            <th class="py-3 px-6 text-left text-xs font-medium text-green-500 uppercase tracking-wider w-[25%]">Tags</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                    </tbody>
                `;

                const degreesTableBody = degreesTable.querySelector('tbody');

                uniData.Degrees.forEach(degree => {
                    const degreeRow = document.createElement('tr');
                    degreeRow.classList.add('hover:bg-yellow-100', 'transition-colors', 'duration-200');
                    const tagsHtml = degree.Tags.map(tag =>
                        `<span class="inline-block bg-green-200 text-green-800 text-xs font-semibold px-2 py-1 rounded-full mr-1 mt-1">${tag}</span>`
                    ).join('');

                    degreeRow.innerHTML = `
                        <td class="py-2 px-6 text-sm font-medium text-gray-900 overflow-hidden text-ellipsis">${degree.DegreeLevel}</td>
                        <td class="py-2 px-6 text-sm font-medium text-gray-900 overflow-hidden text-ellipsis">
                            <a href="${degree.DegreeLink}" target="_blank" class="text-green-700 hover:underline">${degree.Degree}</a>
                        </td>
                        <td class="py-2 px-6 text-sm text-gray-500 overflow-hidden text-ellipsis">
                            <div class="flex flex-wrap">${tagsHtml}</div>
                        </td>
                    `;
                    degreesTableBody.appendChild(degreeRow);
                });

                universityCard.appendChild(degreesTable);
                dataContainer.appendChild(universityCard);
            });

            renderPagination();
        }

        function renderPagination() {
            const paginationNav = document.getElementById('paginationNav');
            paginationNav.innerHTML = '';
            
            // Get the total number of unique universities, not just the filtered subset
            const allUniversities = [...new Set(data.map(item => item.University))].length;

            if (totalPages <= 1) {
                return;
            }

            const prevButton = document.createElement('button');
            prevButton.textContent = 'Previous';
            prevButton.classList.add('px-4', 'py-2', 'rounded-lg', 'bg-green-500', 'text-white', 'font-semibold', 'hover:bg-green-600', 'disabled:bg-gray-400', 'disabled:cursor-not-allowed', 'transition-colors', 'duration-200');
            prevButton.disabled = currentPage === 1;
            prevButton.addEventListener('click', () => {
                currentPage--;
                applyFilters();
            });

            const nextButton = document.createElement('button');
            nextButton.textContent = 'Next';
            nextButton.classList.add('px-4', 'py-2', 'rounded-lg', 'bg-green-500', 'text-white', 'font-semibold', 'hover:bg-green-600', 'disabled:bg-gray-400', 'disabled:cursor-not-allowed', 'transition-colors', 'duration-200');
            nextButton.disabled = currentPage === totalPages;
            nextButton.addEventListener('click', () => {
                currentPage++;
                applyFilters();
            });

            const pageInfo = document.createElement('span');
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            pageInfo.classList.add('text-gray-600');

            paginationNav.appendChild(prevButton);
            paginationNav.appendChild(pageInfo);
            paginationNav.appendChild(nextButton);
        }

        // Add event listeners
        document.getElementById('searchInput').addEventListener('keyup', () => {
            currentPage = 1;
            applyFilters();
        });
        document.getElementById('cityFilter').addEventListener('change', () => {
            currentPage = 1;
            applyFilters();
        });
        document.getElementById('countryFilter').addEventListener('change', () => {
            currentPage = 1;
            applyFilters();
        });
        document.getElementById('degreeLevelFilter').addEventListener('change', () => {
            currentPage = 1;
            applyFilters();
        });
        document.getElementById('degreeFilter').addEventListener('change', () => {
            currentPage = 1;
            applyFilters();
        });
        document.getElementById('limitFilter').addEventListener('change', () => {
            currentPage = 1;
            applyFilters();
        });
    </script>
</body>
</html>
